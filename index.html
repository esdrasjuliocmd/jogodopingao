<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Desafio do Ping√£o</title>
    <style>
        body { font-family: 'Comic Sans MS', sans-serif; background: #fdfdfd; text-align: center; margin: 0; padding-bottom: 50px; }
        .topo { background: #FF6B6B; color: white; padding: 20px; border-radius: 0 0 30px 30px; }
        
        /* TELAS */
        .tela { display: none; padding: 20px; }
        .ativa { display: block; }

        /* LOBBY E ENTRADA */
        .caixa { background: white; border: 3px solid #4ECDC4; border-radius: 20px; padding: 20px; margin: 20px auto; max-width: 400px; box-shadow: 5px 5px 0 #4ECDC4; }
        input { width: 80%; padding: 10px; margin: 10px; border-radius: 10px; border: 2px solid #ddd; font-size: 16px; }
        
        /* JOGO */
        .alvo { background: #FFE66D; margin: 15px; padding: 15px; border-radius: 15px; border: 3px dashed #FF6B6B; font-size: 22px; font-weight: bold; }
        .area-cartas { display: flex; justify-content: center; gap: 10px; margin: 20px; }
        .carta { width: 60px; height: 90px; background: white; border: 3px solid #4ECDC4; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; box-shadow: 4px 4px 0 #4ECDC4; }
        .sinal { padding: 10px 15px; font-size: 18px; margin: 5px; cursor: pointer; border: none; border-radius: 10px; background: #4ECDC4; color: white; }
        
        #pausa { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: #FF6B6B; color: white; z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
        .btn-principal { background: #4ECDC4; color: white; padding: 15px 30px; border: none; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="tela-entrada" class="tela ativa">
        <div class="topo"><h1>üòé Desafio do Ping√£o</h1></div>
        <div class="caixa">
            <h3>Bora jogar?</h3>
            <input type="text" id="nome-player" placeholder="Seu Nome (ex: Ping√£o)">
            <input type="text" id="nome-sala" placeholder="Nome da Sala (ex: churrasco)">
            <br>
            <button class="btn-principal" onclick="conectar()">CRIAR / ENTRAR NA SALA</button>
        </div>
    </div>

    <div id="tela-lobby" class="tela">
        <div class="topo"><h1>üè† Sala: <span id="sala-id">...</span></h1></div>
        <div class="caixa">
            <p>Aguardando a galera entrar...</p>
            <div id="lista-jogadores"></div>
            <br>
            <button class="btn-principal" style="background:#FF6B6B" onclick="comecarJogo()">INICIAR DESAFIO!</button>
        </div>
    </div>

    <div id="tela-jogo" class="tela">
        <div class="topo">
            <h1 id="fase-nome">Hora do Blefe!</h1>
            <div id="relogio" style="font-size:30px">90</div>
        </div>
        <div class="alvo">üéØ ALVO: <span id="num-alvo">11</span></div>
        <div id="visor-conta" style="font-size:30px; margin:20px; background:#eee; padding:10px;">_ ? _</div>
        
        <div class="area-cartas" id="minhas-cartas"></div>

        <div id="controles-jogo">
            <button class="sinal" onclick="colocar('+')">+</button>
            <button class="sinal" onclick="colocar('-')">-</button>
            <button class="sinal" onclick="colocar('*')">√ó</button>
            <button class="sinal" onclick="colocar('/')">√∑</button>
            <button class="sinal" style="background:#ff4757" onclick="limpar()">Limpar</button>
            <br><br>
            <button class="btn-principal" onclick="enviar()">ENVIAR CONTA!</button>
        </div>
    </div>

    <div id="pausa">
        <h1>‚è∏Ô∏è PAUSA DO PING√ÉO</h1>
        <p id="frase-pausa">Vou ali buscar mais um gelo...</p>
        <button class="btn-principal" style="background:#333" onclick="socket.send(JSON.stringify({type:'RESUME'}))">VOLTAR</button>
    </div>

    <script>
        let socket;
        let minhaConta = "";
        let alvoAtual = 11;
        let cartas = [5, 2, 9]; // Isso ser√° sorteado pelo servidor depois

        function conectar() {
            const nome = document.getElementById('nome-player').value;
            const sala = document.getElementById('nome-sala').value;
            if(!nome || !sala) return alert("Preenche tudo, Ping√£o!");

            // CONECTA AO SEU BACKEND
            socket = new WebSocket('wss://pingao-backend.esdrasjulio.workers.dev/');

            socket.onopen = () => {
                socket.send(JSON.stringify({type: 'JOIN', sala: sala, nome: nome}));
                mostrarTela('tela-lobby');
                document.getElementById('sala-id').innerText = sala;
            };

            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if(data.type === 'START') mostrarTela('tela-jogo');
                if(data.type === 'PAUSE') document.getElementById('pausa').style.display = 'flex';
                if(data.type === 'RESUME') document.getElementById('pausa').style.display = 'none';
            };
        }

        function mostrarTela(id) {
            document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa'));
            document.getElementById(id).classList.add('ativa');
        }

        function comecarJogo() { socket.send(JSON.stringify({type: 'START'})); }
        function colocar(v) { minhaConta += v; document.getElementById('visor-conta').innerText = minhaConta; }
        function limpar() { minhaConta = ""; document.getElementById('visor-conta').innerText = "_ ? _"; }

        function enviar() {
            try {
                let res = eval(minhaConta);
                alert("Conta enviada! Resultado: " + res);
            } catch(e) { alert("Conta errada!"); }
        }
    </script>
</body>
</html>
