<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Desafio do Ping√£o</title>
    <style>
        /* VISUAL DO PING√ÉO - COLORIDO E SIMPLES */
        body { font-family: 'Comic Sans MS', sans-serif; background: #fdfdfd; text-align: center; margin: 0; padding-bottom: 50px; color: #333; }
        .topo { background: #FF6B6B; color: white; padding: 20px; border-radius: 0 0 30px 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .tela { display: none; padding: 20px; animation: fadeIn 0.5s; }
        .ativa { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .caixa { background: white; border: 3px solid #4ECDC4; border-radius: 20px; padding: 20px; margin: 20px auto; max-width: 400px; box-shadow: 6px 6px 0 #4ECDC4; }
        input { width: 85%; padding: 12px; margin: 10px; border-radius: 10px; border: 2px solid #ddd; font-size: 16px; }
        
        /* √ÅREA DE JOGO */
        .alvo { background: #FFE66D; margin: 15px; padding: 15px; border-radius: 15px; border: 3px dashed #FF6B6B; font-size: 24px; font-weight: bold; color: #b34a4a; }
        .area-cartas { display: flex; justify-content: center; gap: 12px; margin: 20px; }
        .carta { width: 70px; height: 100px; background: white; border: 3px solid #4ECDC4; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; box-shadow: 4px 4px 0 #4ECDC4; font-weight: bold; transition: 0.2s; }
        .carta:active { transform: scale(0.9); }
        
        .sinal { padding: 15px 20px; font-size: 22px; margin: 5px; cursor: pointer; border: none; border-radius: 12px; background: #4ECDC4; color: white; font-weight: bold; box-shadow: 0 4px 0 #36918a; }
        .sinal:active { transform: translateY(2px); box-shadow: none; }

        .btn-principal { background: #4ECDC4; color: white; padding: 18px 45px; border: none; border-radius: 50px; font-size: 22px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 0 #36918a; transition: 0.2s; }
        .btn-principal:active { transform: translateY(4px); box-shadow: none; }

        #relogio { font-size: 45px; color: #FF6B6B; font-weight: bold; margin: 10px; }
        #visor-conta { font-size: 30px; margin: 20px; background: #f0f0f0; padding: 20px; border-radius: 15px; min-height: 45px; border: 3px solid #ccc; font-weight: bold; }

        /* TELA DE PAUSA */
        #pausa { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: #FF6B6B; color: white; z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <div id="pausa">
        <h1 style="font-size: 40px;">‚è∏Ô∏è PAUSA DO PING√ÉO</h1>
        <p id="frase-pausa" style="font-size: 26px; padding: 20px; font-style: italic;">"Vou ali buscar mais um gelo e j√° volto!"</p>
        <button class="btn-principal" style="background:#333; box-shadow: 0 5px 0 #000;" onclick="voltarJogo()">VOLTAR PRO JOGO</button>
    </div>

    <div id="tela-entrada" class="tela ativa">
        <div class="topo"><h1>üòé Desafio do Ping√£o</h1></div>
        <div class="caixa">
            <h2 style="color: #FF6B6B;">Bora jogar, turma!</h2>
            <input type="text" id="nome-player" placeholder="Seu Nome (ex: Ping√£o)">
            <input type="text" id="nome-sala" placeholder="Nome da Sala (ex: churrasco)">
            <br><br>
            <button class="btn-principal" onclick="conectar()">ENTRAR NA SALA</button>
        </div>
    </div>

    <div id="tela-lobby" class="tela">
        <div class="topo"><h1>üè† Sala: <span id="sala-id">...</span></h1></div>
        <div class="caixa">
            <p style="font-size: 22px;">Aguardando a galera entrar no chat... üå≠</p>
            <p>Assim que todos chegarem, clica no bot√£o abaixo!</p>
            <br>
            <button class="btn-principal" style="background:#FF6B6B; box-shadow: 0 5px 0 #b34a4a;" onclick="comecarJogo()">INICIAR DESAFIO!</button>
        </div>
    </div>

    <div id="tela-jogo" class="tela">
        <div class="topo">
            <h1 id="fase-nome">Bora Blefar! üòú</h1>
            <div id="relogio">90</div>
        </div>
        <div class="alvo">üéØ ALVO: CHEGAR PERTO DE <span id="num-alvo">11</span>!</div>
        <div id="visor-conta">_ ? _</div>
        
        <div class="area-cartas">
            <div class="carta" onclick="colocar('5')">5</div>
            <div class="carta" onclick="colocar('2')">2</div>
            <div class="carta" onclick="colocar('9')">9</div>
        </div>

        <div id="controles-jogo">
            <button class="sinal" onclick="colocar('+')">+</button>
            <button class="sinal" onclick="colocar('-')">-</button>
            <button class="sinal" onclick="colocar('*')">√ó</button>
            <button class="sinal" onclick="colocar('/')">√∑</button>
            <button class="sinal" style="background:#ff4757; box-shadow: 0 4px 0 #b3323d;" onclick="limpar()">Limpar</button>
            <br><br>
            <button class="btn-principal" onclick="enviar()">ENVIAR CONTA!</button>
        </div>
        <br>
        <button onclick="solicitarPausa()" style="background:none; border:2px solid #ccc; border-radius:15px; cursor:pointer; padding: 10px 20px; font-weight: bold; color: #888;">Pausa do Host</button>
    </div>

    <script>
        let socket;
        let minhaConta = "";
        let tempo = 90;
        let timerIniciado = false;

        function mostrarTela(id) {
            document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa'));
            document.getElementById(id).classList.add('ativa');
        }

        function conectar() {
            const nome = document.getElementById('nome-player').value;
            const sala = document.getElementById('nome-sala').value;
            if(!nome || !sala) return alert("Preenche os campos a√≠, Ping√£o!");

            // Conectando ao seu Worker oficial
            socket = new WebSocket('wss://pingao-backend.esdrasjulio.workers.dev/');

            socket.onopen = () => {
                socket.send(JSON.stringify({type: 'JOIN', nome: nome, sala: sala}));
                document.getElementById('sala-id').innerText = sala;
                mostrarTela('tela-lobby');
            };

            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                
                // Comando para todo mundo mudar para a tela de jogo
                if(data.type === 'START') {
                    mostrarTela('tela-jogo');
                    iniciarRelogio();
                }
                
                // Comandos de Pausa
                if(data.type === 'PAUSE') document.getElementById('pausa').style.display = 'flex';
                if(data.type === 'RESUME') document.getElementById('pausa').style.display = 'none';
            };

            socket.onerror = () => alert("Erro ao conectar no servidor do Ping√£o!");
        }

        function comecarJogo() {
            if(socket && socket.readyState === WebSocket.OPEN) {
                // Manda o sinal pro servidor avisar todos
                socket.send(JSON.stringify({type: 'START'}));
            } else {
                // Seguran√ßa: Se o servidor falhar, entra no jogo direto
                mostrarTela('tela-jogo');
                iniciarRelogio();
            }
        }

        function solicitarPausa() { socket.send(JSON.stringify({type: 'PAUSE'})); }
        function voltarJogo() { socket.send(JSON.stringify({type: 'RESUME'})); }

        function colocar(v) { 
            minhaConta += v; 
            document.getElementById('visor-conta').innerText = minhaConta; 
        }

        function limpar() { 
            minhaConta = ""; 
            document.getElementById('visor-conta').innerText = "_ ? _"; 
        }

        function enviar() {
            try {
                // O eval faz a conta matem√°tica m√°gica
                let res = eval(minhaConta);
                let dist = Math.abs(11 - res);
                alert("O Ping√£o viu sua conta!\n\nResultado: " + res + "\nDist√¢ncia do Alvo: " + dist);
            } catch(e) { 
                alert("Epa! Essa conta t√° errada ou incompleta. Limpe e tente de novo!"); 
            }
        }

        function iniciarRelogio() {
            if(timerIniciado) return;
            timerIniciado = true;
            setInterval(() => {
                if(document.getElementById('pausa').style.display !== 'flex' && tempo > 0) {
                    tempo--;
                    document.getElementById('relogio').innerText = tempo;
                }
            }, 1000);
        }
    </script>
</body>
</html>
