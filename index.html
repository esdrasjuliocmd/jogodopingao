<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Desafio do Ping√£o</title>
    <style>
        body { font-family: 'Comic Sans MS', sans-serif; background: #fdfdfd; text-align: center; margin: 0; padding-bottom: 50px; color: #333; }
        .topo { background: #FF6B6B; color: white; padding: 20px; border-radius: 0 0 30px 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .tela { display: none; padding: 20px; }
        .ativa { display: block; }
        .caixa { background: white; border: 3px solid #4ECDC4; border-radius: 20px; padding: 20px; margin: 20px auto; max-width: 400px; box-shadow: 6px 6px 0 #4ECDC4; }
        input { width: 85%; padding: 12px; margin: 10px; border-radius: 10px; border: 2px solid #ddd; font-size: 16px; }
        
        /* √ÅREA DO CONVITE DIRETO */
        .area-convite { background: #FFE66D; padding: 15px; border-radius: 15px; border: 2px dashed #FF6B6B; margin: 15px auto; max-width: 85%; font-size: 14px; }
        .btn-copiar { background: #FF6B6B; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }

        .alvo { background: #FFE66D; margin: 15px; padding: 15px; border-radius: 15px; border: 3px dashed #FF6B6B; font-size: 24px; font-weight: bold; }
        .area-cartas { display: flex; justify-content: center; gap: 10px; margin: 20px; }
        .carta { width: 70px; height: 100px; background: white; border: 3px solid #4ECDC4; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; box-shadow: 4px 4px 0 #4ECDC4; font-weight: bold; }
        .sinal { padding: 15px 20px; font-size: 22px; margin: 5px; cursor: pointer; border: none; border-radius: 12px; background: #4ECDC4; color: white; font-weight: bold; box-shadow: 0 4px 0 #36918a; }
        .btn-principal { background: #4ECDC4; color: white; padding: 18px 45px; border: none; border-radius: 50px; font-size: 22px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 0 #36918a; }
        
        #visor-conta { font-size: 30px; margin: 20px; background: #f0f0f0; padding: 20px; border-radius: 15px; min-height: 45px; border: 3px solid #ccc; font-weight: bold; }
        #pausa { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: #FF6B6B; color: white; z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <div id="pausa">
        <h1>‚è∏Ô∏è PAUSA DO PING√ÉO</h1>
        <p style="font-size: 24px;">Vai l√° no cooler que o Ping√£o espera!</p>
        <button class="btn-principal" style="background:#333" onclick="socket.send(JSON.stringify({type:'RESUME'}))">VOLTAR</button>
    </div>

    <div id="tela-entrada" class="tela ativa">
        <div class="topo"><h1>üòé Desafio do Ping√£o</h1></div>
        <div class="caixa">
            <h3 id="titulo-entrada">Crie ou Entre na Sala</h3>
            <input type="text" id="nome-player" placeholder="Seu Nome">
            <input type="text" id="nome-sala" placeholder="Nome da Sala" oninput="gerarLink()">
            
            <div id="box-link" class="area-convite" style="display: none;">
                <b>Link M√°gico para a fam√≠lia:</b><br>
                <small id="link-exibicao"></small><br>
                <button class="btn-copiar" onclick="copiarLink()">Copiar Link de Convite üöÄ</button>
            </div>

            <br>
            <button class="btn-principal" onclick="conectar()">ENTRAR NO JOGO</button>
        </div>
    </div>

    <div id="tela-lobby" class="tela">
        <div class="topo"><h1>üè† Sala: <span id="sala-id">...</span></h1></div>
        <div class="caixa">
            <p style="font-size: 20px;">Aguardando a galera... üå≠</p>
            <p>Mande o link para o pessoal entrar direto!</p>
            <br>
            <button class="btn-principal" style="background:#FF6B6B; box-shadow: 0 5px 0 #b34a4a;" onclick="comecarJogo()">INICIAR DESAFIO!</button>
        </div>
    </div>

    <div id="tela-jogo" class="tela">
        <div class="topo"><h1>Bora Blefar!</h1><div id="relogio" style="font-size: 30px;">90</div></div>
        <div class="alvo">üéØ ALVO: CHEGAR PERTO DE 11</div>
        <div id="visor-conta">_ ? _</div>
        <div class="area-cartas">
            <div class="carta" onclick="colocar('5')">5</div>
            <div class="carta" onclick="colocar('2')">2</div>
            <div class="carta" onclick="colocar('9')">9</div>
        </div>
        <div>
            <button class="sinal" onclick="colocar('+')">+</button>
            <button class="sinal" onclick="colocar('-')">-</button>
            <button class="sinal" onclick="colocar('*')">√ó</button>
            <button class="sinal" onclick="colocar('/')">√∑</button>
            <button class="sinal" style="background:#ff4757" onclick="limpar()">Limpar</button>
        </div>
        <br>
        <button class="btn-principal" onclick="enviar()">ENVIAR JOGADA!</button>
    </div>

    <script>
        let socket;
        let minhaConta = "";
        let tempo = 90;

        // AO CARREGAR: Verifica se j√° tem sala no link
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const salaNoLink = params.get('sala');
            if(salaNoLink) {
                document.getElementById('nome-sala').value = salaNoLink;
                document.getElementById('titulo-entrada').innerText = "Voc√™ foi convidado para a sala: " + salaNoLink;
                document.getElementById('nome-sala').style.backgroundColor = "#e8f5e9";
            }
        };

        // GERA O LINK M√ÅGICO
        function gerarLink() {
            const sala = document.getElementById('nome-sala').value;
            const box = document.getElementById('box-link');
            const exibicao = document.getElementById('link-exibicao');
            
            if(sala.length > 2) {
                const linkMagico = window.location.origin + window.location.pathname + "?sala=" + encodeURIComponent(sala);
                box.style.display = "block";
                exibicao.innerText = linkMagico;
            } else {
                box.style.display = "none";
            }
        }

        function copiarLink() {
            const sala = document.getElementById('nome-sala').value;
            const linkMagico = window.location.origin + window.location.pathname + "?sala=" + encodeURIComponent(sala);
            const textoFinal = `Bora pro Desafio do Ping√£o! üçª\nClica no link e coloca seu nome:\n${linkMagico}`;
            
            navigator.clipboard.writeText(textoFinal);
            alert("‚úÖ Link M√°gico copiado! S√≥ colar no Zap.");
        }

        function mostrarTela(id) {
            document.querySelectorAll('.tela').forEach(t => t.classList.remove('ativa'));
            document.getElementById(id).classList.add('ativa');
        }

        function conectar() {
            const n = document.getElementById('nome-player').value;
            const s = document.getElementById('nome-sala').value;
            if(!n || !s) return alert("Preenche o nome e a sala, Ping√£o!");

            socket = new WebSocket('wss://pingao-backend.esdrasjulio.workers.dev/');

            socket.onopen = () => {
                socket.send(JSON.stringify({type:'JOIN', nome:n, sala:s}));
                document.getElementById('sala-id').innerText = s;
                mostrarTela('tela-lobby');
            };

            socket.onmessage = (e) => {
                const d = JSON.parse(e.data);
                if(d.type === 'START') { mostrarTela('tela-jogo'); iniciarRelogio(); }
                if(d.type === 'PAUSE') document.getElementById('pausa').style.display = 'flex';
                if(d.type === 'RESUME') document.getElementById('pausa').style.display = 'none';
            };
        }

        function comecarJogo() {
            if(socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({type:'START'}));
            }
        }

        function colocar(v) { minhaConta += v; document.getElementById('visor-conta').innerText = minhaConta; }
        function limpar() { minhaConta = ""; document.getElementById('visor-conta').innerText = "_ ? _"; }

        function enviar() {
            try {
                let r = eval(minhaConta);
                alert("Resultado: " + r + "\nDist√¢ncia: " + Math.abs(11 - r));
            } catch(e) { alert("Conta errada!"); }
        }

        function iniciarRelogio() {
            setInterval(() => {
                if(document.getElementById('pausa').style.display !== 'flex' && tempo > 0) {
                    tempo--; document.getElementById('relogio').innerText = tempo;
                }
            }, 1000);
        }
    </script>
</body>
</html>
