<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Casa de Jogos do PingÃ£o ğŸª</title>

<style>
/* ===== RESET / BASE ===== */
*{box-sizing:border-box}
html,body{margin:0;padding:0}
body{
  font-family: ui-rounded, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
  background:
    radial-gradient(circle at 10% 10%, #ffffff88, transparent 40%),
    radial-gradient(circle at 90% 20%, #ffffff55, transparent 50%),
    linear-gradient(135deg,#6a5cff,#00d4ff,#00ff9a,#ffe600);
  min-height:100vh;
  color:#111;
}

/* ===== LAYOUT ===== */
.wrap{max-width:1100px;margin:auto;padding:16px}
.card{
  background:rgba(255,255,255,.88);
  border-radius:18px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 14px 32px rgba(0,0,0,.15);
}
h1,h2,h3{margin:6px 0}
.hidden{display:none}

/* ===== BOTÃ•ES ===== */
button{
  border:none;
  border-radius:14px;
  padding:12px 16px;
  font-weight:900;
  cursor:pointer;
  background:linear-gradient(135deg,#ffe600,#00ff9a,#00d4ff);
  box-shadow:0 10px 24px rgba(0,0,0,.18);
}
button.secondary{
  background:#eee;
}
button.danger{
  background:linear-gradient(135deg,#ff5a5a,#ff2bd6);
  color:#fff;
}

/* ===== INPUT ===== */
input{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid #ccc;
  margin-bottom:8px;
}

/* ===== STATUS ===== */
.statusDot{
  display:inline-block;
  width:10px;height:10px;
  border-radius:50%;
  background:#ff3b3b;
}
.statusDot.on{background:#16c172}

/* ===== JOGADORES ===== */
.players{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:8px;
}
.player{
  background:#fff;
  padding:8px;
  border-radius:12px;
  font-size:14px;
  box-shadow:0 6px 14px rgba(0,0,0,.1);
}

/* ===== CARTAS ===== */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
}
.cardItem{
  background:#fff;
  padding:12px;
  border-radius:16px;
  cursor:pointer;
  border:3px solid transparent;
  transition:.15s;
}
.cardItem:hover{transform:scale(1.02)}
.cardItem.selected{
  border-color:#ff2bd6;
}

/* ===== RESULTADO ===== */
.resultBox{
  background:#fff3c4;
  border-radius:16px;
  padding:16px;
  font-weight:900;
  font-size:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
}

/* ===== CHAT ===== */
.chatLog{
  background:#fff;
  border-radius:14px;
  padding:10px;
  max-height:220px;
  overflow:auto;
}
.msg{font-size:13px;margin:6px 0}
.msg b{font-weight:900}

/* ===== TIMER ===== */
.timer{
  font-weight:900;
  font-size:16px;
}
</style>
</head>

<body>
<div class="wrap">

<h1>ğŸª Casa de Jogos do PingÃ£o</h1>

<!-- ===== SETUP ===== -->
<div class="card">
  <h3>Entrar / Criar sala</h3>

  <input id="backend" value="https://pingao-backend.esdrasjulio.workers.dev">
  <input id="nick" placeholder="Seu apelido">
  <input id="roomCode" placeholder="CÃ³digo da sala">

  <button onclick="createRoom()">âœ¨ Criar sala</button>
  <button class="secondary" onclick="joinRoom()">ğŸšª Entrar</button>

  <p>
    <span class="statusDot" id="statusDot"></span>
    <span id="statusTxt">Desconectado</span>
  </p>

  <p><b>Sala:</b> <span id="roomLabel">â€”</span></p>
</div>

<!-- ===== ESTADO ===== -->
<div class="card">
  <h2 id="stage">Lobby</h2>
  <p id="hint">Marque pronto e o host inicia.</p>
  <p class="timer" id="timer"></p>

  <button id="btnStart" onclick="startGame()">ğŸš€ ComeÃ§ar</button>
</div>

<!-- ===== JOGADORES ===== -->
<div class="card">
  <h3>ğŸ‘¥ Jogadores</h3>
  <div class="players" id="players"></div>
</div>

<!-- ===== VOTAÃ‡ÃƒO ===== -->
<div class="card hidden" id="voteArea">
  <h3>ğŸƒ VotaÃ§Ã£o de Vantagens</h3>
  <div class="cards" id="cards"></div>
</div>

<!-- ===== RESULTADO ===== -->
<div class="card hidden" id="resultArea">
  <h3>ğŸ Resultado da rodada</h3>
  <div class="resultBox" id="resultText"></div>
</div>

<!-- ===== CHAT ===== -->
<div class="card">
  <h3>ğŸ’¬ Chat</h3>
  <input id="chatInput" placeholder="Digite algo divertidoâ€¦">
  <button onclick="sendChat()">Enviar</button>
  <div class="chatLog" id="chatLog"></div>
</div>

</div>

<script>
/* =========================================================
   CONFIG
========================================================= */
const CARDS = [
 {id:"C1",t:"ğŸˆ BalÃ£o da Sorte",p:2},
 {id:"C2",t:"ğŸ§ƒ Suco Turbo",p:3},
 {id:"C3",t:"ğŸ¦„ UnicÃ³rnio do Blefe",p:4},
 {id:"C4",t:"ğŸ­ AlgodÃ£o Doce",p:1},
 {id:"C5",t:"ğŸº Buzina MÃ¡gica",p:2},
 {id:"C6",t:"ğŸª„ Varinha Confete",p:3},
 {id:"C7",t:"ğŸ£ Pintinho Ninja",p:2},
 {id:"C8",t:"ğŸ‰ Melancia Misteriosa",p:4},
 {id:"C9",t:"ğŸ¥³ ChapÃ©u do Host",p:1},
 {id:"C10",t:"ğŸ² Sorteio RelÃ¢mpago",p:5},
 {id:"C11",t:"ğŸ§  CÃ©rebro Colorido",p:3},
 {id:"C12",t:"ğŸ¦– Dino Fofo",p:2},
];

let ws=null;
let state=null;
let votedRound=null;

const pid = localStorage.pid || (localStorage.pid=Math.random().toString(16).slice(2));
const $ = id => document.getElementById(id);

/* =========================================================
   CONEXÃƒO
========================================================= */
function createRoom(){
 fetch($("backend").value+"/api/room/create",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({nick:$("nick").value,playerId:pid})
 }).then(r=>r.json()).then(d=>{
  $("roomCode").value=d.roomCode;
  connectWs(d.wsUrl);
 });
}

function joinRoom(){
 fetch($("backend").value+"/api/room/join",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({roomCode:$("roomCode").value,nick:$("nick").value,playerId:pid})
 }).then(r=>r.json()).then(d=>connectWs(d.wsUrl));
}

function connectWs(url){
 ws=new WebSocket(url);
 ws.onopen=()=>{
  $("statusTxt").innerText="Online";
  $("statusDot").classList.add("on");
 };
 ws.onclose=()=>{
  $("statusTxt").innerText="Desconectado";
  $("statusDot").classList.remove("on");
 };
 ws.onmessage=e=>{
  const m=JSON.parse(e.data);
  if(m.type==="state"){
    state=m.state;
    render();
  }
 };
}

function startGame(){
 if(state?.phase==="lobby"){
  ws.send(JSON.stringify({type:"start"}));
 }
}

/* =========================================================
   CHAT
========================================================= */
function sendChat(){
 const t=$("chatInput").value.trim();
 if(!t) return;
 ws.send(JSON.stringify({type:"chat",text:t}));
 $("chatInput").value="";
}

/* =========================================================
   VOTO
========================================================= */
function vote(card){
 if(state.phase!=="vote") return;
 if(votedRound===state.round) return;
 votedRound=state.round;
 ws.send(JSON.stringify({type:"vote",cardId:card}));
}

/* =========================================================
   RENDER
========================================================= */
function render(){
 $("roomLabel").innerText=state.roomCode||"â€”";

 // players
 $("players").innerHTML="";
 Object.values(state.players).forEach(p=>{
  $("players").innerHTML+=`<div class="player">${p.nick}<br>â­ ${p.score}</div>`;
 });

 // botÃ£o comeÃ§ar
 $("btnStart").style.display = state.phase==="lobby" ? "inline-block" : "none";

 // esconder Ã¡reas
 $("voteArea").classList.add("hidden");
 $("resultArea").classList.add("hidden");

 if(state.phase==="lobby"){
  $("stage").innerText="ğŸ Lobby";
  $("hint").innerText="Marque pronto e o host inicia.";
 }

 if(state.phase==="vote"){
  $("stage").innerText=`ğŸ—³ï¸ VotaÃ§Ã£o â€¢ Rodada ${state.round}/10`;
  $("hint").innerText="Escolha uma carta.";
  $("voteArea").classList.remove("hidden");
  renderCards();
 }

 if(state.phase==="result"){
  $("stage").innerText=`ğŸ Resultado â€¢ Rodada ${state.round}/10`;
  $("resultArea").classList.remove("hidden");
  const last=state.chat[state.chat.length-1];
  $("resultText").innerText = last ? last.text : "Resultado";
 }

 // timer
 if(state.endsAtMs){
  const t=Math.max(0,Math.ceil((state.endsAtMs-Date.now())/1000));
  $("timer").innerText=`â± ${t}s`;
 }else{
  $("timer").innerText="";
 }
}

function renderCards(){
 $("cards").innerHTML="";
 CARDS.forEach(c=>{
  const d=document.createElement("div");
  d.className="cardItem";
  d.innerHTML=`${c.t}<br><b>+${c.p}</b>`;
  d.onclick=()=>vote(c.id);
  $("cards").appendChild(d);
 });
}
</script>

</body>
</html>
